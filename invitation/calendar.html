<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="Content-Script-Type" content="text/javascript">
    <meta http-equiv="Content-Style-Type" content="text/css">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <meta id="viewportTag" name="viewport" content="width=device-width, initial-scale=1.0, maximun-scale=1.0, user-scalable=no">

    <meta name="author" content="박준영❤️최영은 결혼합니다">
    <meta name="keywords" content="박준영❤️최영은 결혼합니다">
    <meta name="description" content="2025년 8월 31일 일요일 웨딩그룹위더스 영등포">

    <meta property="og:type" content="website">
    <meta property="og:title" content="박준영❤️최영은 결혼합니다">
    <meta property="og:description" content="2025년 8월 31일 일요일 웨딩그룹위더스 영등포">
    <meta property="og:image" content="https://raw.githubusercontent.com/pjy0509/pjy0509.github.io/refs/heads/main/invitation/assets/images/i0.jpg">
    <meta property="og:url" content="https://pjy0509.github.io/invitation">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="박준영❤️최영은 결혼합니다">
    <meta name="twitter:description" content="2025년 8월 31일 일요일 웨딩그룹위더스 영등포">
    <meta name="twitter:image" content="https://raw.githubusercontent.com/pjy0509/pjy0509.github.io/refs/heads/main/invitation/assets/images/i0.jpg">

    <meta name="format-detection" content="telephone=no">

    <title>박준영❤️최영은 결혼합니다</title>

    <link rel="icon" href="FAVICON" type="image/x-icon">
    <link rel="shortcut icon" href="FAVICON" type="image/x-icon">

    <link href="https://fonts.cdnfonts.com/css/heuristica" rel="stylesheet">

    <!-- Native -->
    <script src="https://unpkg.com/native-fn@latest/dist/index.umd.js"></script>
    <!-- Particles -->
    <script src="https://cdn.jsdelivr.net/npm/tsparticles@3.8.1/tsparticles.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tsparticles/shape-image@3.8.1/tsparticles.shape.image.min.js"></script>
    <!-- Carousel -->
    <script src="https://unpkg.com/@glidejs/glide"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@glidejs/glide/dist/css/glide.core.min.css">

    <link rel="stylesheet" type="text/css" href="style/style.css">

    <script charset="UTF-8" class="daum_roughmap_loader_script" src="https://ssl.daumcdn.net/dmaps/map_js_init/roughmapLoader.js"></script>
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.5/kakao.min.js" integrity="sha384-dok87au0gKqJdxs7msEdBPNnKSRT+/mhTVzq+qOhcL464zXwvcrpjeWvyj1kCdq6" crossorigin="anonymous"></script>
    <script>Kakao.init("81d57ff9f2d2a5524e506d8a1d386fd5");</script>
</head>
<body>
<script type="text/javascript">
    window.onload = function () {
        createSchedule();
    }

    function createSchedule() {
        let kakaoAccessToken = localStorage.getItem("kakaoAccessToken");
        
        if (kakaoAccessToken != null) {
            init();
        } else {
            create();
        }

        function init() {
            const search = new URLSearchParams(location.search);
            const clientId = encodeURIComponent("7c29ec39d56410088e1ba66176d61b4b");
            const redirectURI = encodeURIComponent("https://pjy0509.github.io/invitation/calendar");
    
            if (search.has("code")) {
                const grantType = encodeURIComponent("authorization_code");
                const code = search.get("code");
                const url = location.protocol + "//" + location.host + location.pathname + location.hash;
                
                window.history.replaceState(null, '', url);
                
                fetch(
                    "https://kauth.kakao.com/oauth/token"
                    + "?grant_type=" + grantType 
                    + "&client_id=" + clientId 
                    + "&redirect_uri=" + redirectURI 
                    + "&code=" + code,
                    {
                        method: "POST"
                    }
                )
                .then(function (response) {
                    return response.json();
                })
                .then(function (response) {
                    localStorage.setItem("kakaoAccessToken", kakaoAccessToken = response.access_token);

                    createSchedule();
                });
            } else {
                const responseType = encodeURIComponent("code");
                const scope = encodeURIComponent("talk_calendar");
                
                location.href = "https://kauth.kakao.com/oauth/authorize" 
                    + "?client_id=" + clientId 
                    + "&redirect_uri=" + redirectURI 
                    + "&response_type=" + responseType 
                    + "&scope=" + scope;
            }
        }

        function create() {
            const startAt = "2025-08-31T03:20:00Z";
            const endAt = "2025-08-31T04:30:00Z";
            const body = {
                "title": "박준영❤️최영은 결혼식",
                "time": {
                    "start_at": "2025-08-31T03:20:00Z",
                    "end_at": "2025-08-31T04:30:00Z",
                    "time_zone": "Asia/Seoul",
                    "all_day": false,
                    "lunar": false
                },
                "description": "2025년 8월 31일 일요일 웨딩그룹위더스 영등포",
                "location": {
                    "name": "웨딩그룹위더스 영등포",
                    "location_id": 24250591,
                    "address": "서울 영등포구 영중로 55",
                    "latitude": 37.5213713,
                    "longitude": 126.9044943
                },
                "reminders": [
                    60,
                    120
                ],
                "color": "RED"
            };
            
            fetch(
                "https://kapi.kakao.com/v2/api/calendar/events" 
                + "?from=" + encodeURIComponent(startAt) 
                + "&to=" + encodeURIComponent(endAt),
                {
                    headers : {
                        "Authorization" : "Bearer " + kakaoAccessToken,
                    }
                }
            )
                .then(function (response) {
                    return response.json();
                })
                .then(function (response) {
                    const duplicated = response.events.findIndex(function (event) {
                        return event.title === body.title;
                    }) !== -1;

                    if (!duplicated) {
                        const bodyString = JSON.stringify(body);
                
                        fetch(
                            "https://kapi.kakao.com/v2/api/calendar/create/event",
                            {
                                method: "POST",
                                headers : {
                                    "Authorization" : "Bearer " + kakaoAccessToken,
                                    "Content-Type": "application/x-www-form-urlencoded"
                                },
                                body: "event=" + encodeURIComponent(bodyString),
                            }
                        )
                            .then(function (response) {
                                return response.json();
                            })
                            .then(function (response) {
                                console.log(response.event_id);
                            });
                    } else {
                        console.log(response.events[0].id);
                    }
                });
        }
    }
</script>
</body>
</html>
